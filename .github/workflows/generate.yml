name: Generate Sunday Sticker

on:
  workflow_dispatch:
    inputs:
      style:
        description: '貼紙樣式 (e.g. birthday, christmas)'
        required: true
        default: 'new_year'
        type: string
      text:
        description: '貼紙文字 (e.g. Happy Purr-thday!)'
        required: false
        default: 'Happy Meow Year'
        type: string
      font_name:
        description: '字型名稱（不含副檔名，例如 starborn）'
        required: false
        default: 'default'
        type: string

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: 拉取最新程式碼
        uses: actions/checkout@v4

      - name: 設定 Python 環境
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: 安裝依賴（包括 Pillow）
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt || echo "無 requirements.txt，跳過"

      - name: 執行貼紙生成器（傳入 style、text、font_name）
        run: |
          echo "=== Debug: inputs ==="
          echo "style     : '${{ inputs.style }}'"
          echo "text      : '${{ inputs.text }}'"
          echo "font_name : '${{ inputs.font_name }}'"
          echo "=== 執行 Python 腳本 ==="
          python src/generate_sticker.py \
            "${{ inputs.style || 'new_year' }}" \
            "${{ inputs.text || 'Happy Meow Year' }}" \
            "${{ inputs.font_name || 'default' }}"

      - name: Commit and push generated sticker
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions@github.com'
          git add assets/generated/*
          git commit -m "Auto-generate sticker: ${{ inputs.style || 'new_year' }}_${{ inputs.font_name || 'default' }}_${{ github.run_id }}" || echo "No changes to commit"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
